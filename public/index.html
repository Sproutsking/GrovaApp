<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.png" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    />

    <meta name="theme-color" content="#84cc16" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Xeevia" />
    <meta name="application-name" content="Xeevia" />
    <meta name="msapplication-TileColor" content="#000000" />
    <meta name="msapplication-TileImage" content="/logo192.png" />
    <meta
      name="description"
      content="Own your content. Build your network. Earn engagement."
    />

    <!-- Open Graph -->
    <meta property="og:title" content="Xeevia — Own Your Social" />
    <meta
      property="og:description"
      content="Own your content. Build your network. Earn engagement."
    />
    <meta property="og:type" content="website" />

    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/logo192.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="/logo192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/logo512.png" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />

    <!--
      ══════════════════════════════════════════════════════════════════════
      ABORT ERROR SUPPRESSOR — MUST be first script in the document
      ══════════════════════════════════════════════════════════════════════
    -->
    <script>
      (function () {
        "use strict";

        var ABORT_PATTERNS = [
          "aborterror",
          "signal is aborted",
          "signal is aborted without reason",
          "aborted without reason",
          "the user aborted",
          "the operation was aborted",
          "user aborted a request",
          "operation was aborted",
          "request was aborted",
          "fetch was aborted",
          "the fetch was aborted",
        ];

        function isAbortLike(value) {
          if (value === null || value === undefined) return false;
          if (value.name === "AbortError") return true;
          if (value.code === 20) return true;
          var combined = "";
          try {
            if (typeof value === "string") {
              combined = value;
            } else {
              var parts = [
                value.message,
                value.reason,
                value.reason && value.reason.message,
                value.reason && value.reason.name,
                value.name,
                value.type,
              ];
              for (var i = 0; i < parts.length; i++) {
                var p = parts[i];
                if (p === null || p === undefined) continue;
                combined += " " + (typeof p === "string" ? p : String(p));
              }
            }
          } catch (e) {
            return false;
          }
          var lower = combined.toLowerCase();
          for (var j = 0; j < ABORT_PATTERNS.length; j++) {
            if (lower.indexOf(ABORT_PATTERNS[j]) !== -1) return true;
          }
          return false;
        }

        function suppressAbort(event) {
          if (isAbortLike(event.reason)) {
            event.preventDefault();
            event.stopImmediatePropagation();
          }
        }
        window.addEventListener("unhandledrejection", suppressAbort, true);
        window.addEventListener("unhandledrejection", suppressAbort, false);

        window.addEventListener(
          "error",
          function (event) {
            if (
              isAbortLike(event.error) ||
              isAbortLike({ message: event.message || "" })
            ) {
              event.preventDefault();
              event.stopImmediatePropagation();
            }
          },
          true,
        );

        window.onerror = function (msg, src, line, col, err) {
          if (isAbortLike(err) || isAbortLike({ message: String(msg || "") }))
            return true;
          return false;
        };

        var _origConsoleError = console.error;
        console.error = function () {
          var args = Array.prototype.slice.call(arguments);
          for (var i = 0; i < args.length; i++) {
            var a = args[i];
            if (!a) continue;
            if (isAbortLike(a)) return;
            if (typeof a === "string" && isAbortLike({ message: a })) return;
            try {
              var s = String(a);
              if (s !== "[object Object]" && isAbortLike({ message: s }))
                return;
            } catch (e) {
              /* ignore */
            }
          }
          _origConsoleError.apply(console, args);
        };

        var _origDispatch = window.dispatchEvent.bind(window);
        window.dispatchEvent = function (event) {
          try {
            if (
              event instanceof ErrorEvent &&
              isAbortLike({ message: event.message || "" })
            )
              return true;
            if (
              typeof PromiseRejectionEvent !== "undefined" &&
              event instanceof PromiseRejectionEvent &&
              isAbortLike(event.reason)
            )
              return true;
          } catch (e) {
            /* never throw from suppressor */
          }
          return _origDispatch(event);
        };

        if (typeof window.reportError === "function") {
          var _origReportError = window.reportError;
          window.reportError = function (err) {
            if (isAbortLike(err)) return;
            _origReportError.call(window, err);
          };
        }
      })();
    </script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        margin: 0;
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background: #000;
        color: #fff;
        overflow-x: hidden;
        overscroll-behavior: none;
      }

      input,
      textarea,
      select {
        font-size: 16px !important;
      }

      /* ── LOADING SCREEN ── */
      #loading-screen {
        position: fixed;
        inset: 0;
        background: #000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        gap: 0;
      }

      .loading-wordmark {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        margin-bottom: 40px;
        animation: fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) both;
      }

      .loading-logo {
        font-size: 64px;
        font-weight: 900;
        background: linear-gradient(
          135deg,
          #a3e635 0%,
          #84cc16 50%,
          #65a30d 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-family: "Space Grotesk", sans-serif;
        letter-spacing: -2px;
        line-height: 1;
      }

      .loading-tagline {
        font-size: 12px;
        font-weight: 500;
        color: #3f3f46;
        letter-spacing: 3px;
        text-transform: uppercase;
      }

      .spinner-wrap {
        animation: fadeUp 0.6s 0.15s cubic-bezier(0.16, 1, 0.3, 1) both;
      }

      .spinner {
        width: 32px;
        height: 32px;
        border: 2px solid rgba(132, 204, 22, 0.12);
        border-top-color: #84cc16;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ── UPDATE BANNER ── */
      /* Shown when SW_UPDATED message is received — prompts Grova/old-Xeevia
         users to reload and get the latest version */
      #update-banner {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(9, 9, 11, 0.97);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border-top: 1px solid rgba(132, 204, 22, 0.3);
        padding: 14px 16px;
        padding-bottom: max(18px, env(safe-area-inset-bottom));
        z-index: 10002;
        display: none;
        animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      }

      #update-banner.show {
        display: block;
      }

      .update-content {
        max-width: 480px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .update-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: linear-gradient(135deg, #84cc16, #4d7c0f);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: 900;
        color: #000;
        font-family: "Space Grotesk", sans-serif;
        flex-shrink: 0;
        box-shadow: 0 4px 14px rgba(132, 204, 22, 0.3);
      }

      .update-text {
        flex: 1;
        min-width: 0;
      }

      .update-title {
        font-size: 14px;
        font-weight: 700;
        color: #fff;
        margin-bottom: 2px;
        letter-spacing: -0.2px;
      }

      .update-subtitle {
        font-size: 12px;
        color: #71717a;
      }

      .update-actions {
        display: flex;
        gap: 8px;
        flex-shrink: 0;
      }

      .update-btn {
        padding: 9px 16px;
        border-radius: 9px;
        font-size: 13px;
        font-weight: 700;
        cursor: pointer;
        border: none;
        transition: all 0.18s;
        white-space: nowrap;
        font-family: "Inter", sans-serif;
      }

      .update-btn.primary {
        background: linear-gradient(135deg, #84cc16, #65a30d);
        color: #000;
        box-shadow: 0 2px 10px rgba(132, 204, 22, 0.3);
      }

      .update-btn.primary:active {
        transform: scale(0.96);
      }

      .update-btn.secondary {
        background: rgba(255, 255, 255, 0.05);
        color: #71717a;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      /* ── PWA INSTALL PROMPT ── */
      .install-prompt {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(9, 9, 11, 0.97);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border-top: 1px solid rgba(132, 204, 22, 0.15);
        padding: 16px;
        padding-bottom: max(20px, env(safe-area-inset-bottom));
        z-index: 10000;
        display: none;
        animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .install-prompt.show {
        display: block;
      }

      .install-content {
        max-width: 480px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        gap: 14px;
      }

      .install-icon {
        width: 50px;
        height: 50px;
        border-radius: 13px;
        background: linear-gradient(135deg, #84cc16 0%, #4d7c0f 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        font-weight: 900;
        color: #000;
        flex-shrink: 0;
        font-family: "Space Grotesk", sans-serif;
        letter-spacing: -0.5px;
        box-shadow: 0 4px 16px rgba(132, 204, 22, 0.25);
      }

      .install-text {
        flex: 1;
        min-width: 0;
      }

      .install-title {
        font-size: 15px;
        font-weight: 700;
        color: #fff;
        margin: 0 0 3px;
        letter-spacing: -0.2px;
      }

      .install-subtitle {
        font-size: 12px;
        color: #71717a;
        margin: 0;
      }

      .install-actions {
        display: flex;
        gap: 8px;
        flex-shrink: 0;
      }

      .install-btn {
        padding: 10px 18px;
        border-radius: 10px;
        font-size: 13px;
        font-weight: 700;
        cursor: pointer;
        border: none;
        transition: all 0.18s ease;
        white-space: nowrap;
        font-family: "Inter", sans-serif;
      }

      .install-btn.primary {
        background: linear-gradient(135deg, #84cc16, #65a30d);
        color: #000;
        box-shadow: 0 2px 10px rgba(132, 204, 22, 0.3);
      }

      .install-btn.primary:active {
        transform: scale(0.96);
      }

      .install-btn.secondary {
        background: rgba(255, 255, 255, 0.05);
        color: #71717a;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      /* ── INSTALL MODAL ── */
      .install-modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        z-index: 10001;
        display: none;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
      }

      .install-modal-overlay.show {
        display: flex;
      }

      .install-modal {
        background: rgba(18, 18, 18, 0.98);
        border: 1px solid rgba(132, 204, 22, 0.25);
        border-radius: 20px;
        max-width: 420px;
        width: calc(100% - 40px);
        padding: 28px 24px 24px;
        box-shadow:
          0 24px 64px rgba(0, 0, 0, 0.8),
          0 0 0 1px rgba(132, 204, 22, 0.1);
        animation: modalSlideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes slideUp {
        from {
          transform: translateY(100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      @keyframes modalSlideUp {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.96);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .modal-header {
        display: flex;
        align-items: flex-start;
        gap: 14px;
        margin-bottom: 20px;
      }

      .modal-icon {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        background: linear-gradient(135deg, #84cc16 0%, #4d7c0f 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: 900;
        color: #000;
        flex-shrink: 0;
        font-family: "Space Grotesk", sans-serif;
        box-shadow: 0 6px 20px rgba(132, 204, 22, 0.35);
      }

      .modal-text {
        flex: 1;
      }

      .modal-title {
        font-size: 20px;
        font-weight: 800;
        color: #fff;
        margin: 0 0 6px;
        letter-spacing: -0.3px;
      }

      .modal-subtitle {
        font-size: 13px;
        color: #a1a1aa;
        margin: 0;
        line-height: 1.5;
      }

      .modal-features {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 14px;
        margin-bottom: 20px;
      }

      .modal-feature {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 6px 0;
        font-size: 13px;
        color: #d4d4d8;
      }

      .modal-feature-icon {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: rgba(132, 204, 22, 0.15);
        color: #84cc16;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        flex-shrink: 0;
      }

      .modal-buttons {
        display: flex;
        gap: 10px;
      }

      .modal-btn {
        flex: 1;
        padding: 14px 20px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 700;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
        font-family: "Inter", sans-serif;
      }

      .modal-btn.primary {
        background: linear-gradient(135deg, #84cc16, #65a30d);
        color: #000;
        box-shadow: 0 4px 16px rgba(132, 204, 22, 0.3);
      }

      .modal-btn.primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(132, 204, 22, 0.4);
      }
      .modal-btn.primary:active {
        transform: scale(0.97);
      }

      .modal-btn.secondary {
        background: rgba(255, 255, 255, 0.05);
        color: #a1a1aa;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .modal-btn.secondary:hover {
        background: rgba(255, 255, 255, 0.08);
        color: #d4d4d8;
      }

      @media (max-width: 480px) {
        .loading-logo {
          font-size: 52px;
        }
        .install-content {
          flex-wrap: wrap;
        }
        .install-actions {
          width: 100%;
          margin-top: 4px;
        }
        .install-btn {
          flex: 1;
          padding: 12px 16px;
          font-size: 13px;
        }
        .update-actions {
          flex-direction: column;
        }
        .update-btn {
          text-align: center;
        }
      }

      @media (min-width: 769px) {
        .install-prompt {
          bottom: 24px;
          left: 24px;
          right: auto;
          max-width: 380px;
          border-radius: 18px;
          border: 1px solid rgba(132, 204, 22, 0.2);
          box-shadow:
            0 16px 48px rgba(0, 0, 0, 0.7),
            0 0 0 1px rgba(132, 204, 22, 0.05);
        }
        .install-content {
          max-width: none;
        }

        #update-banner {
          bottom: 24px;
          left: 24px;
          right: auto;
          max-width: 400px;
          border-radius: 16px;
          border: 1px solid rgba(132, 204, 22, 0.25);
          box-shadow: 0 16px 48px rgba(0, 0, 0, 0.7);
        }
        .update-content {
          max-width: none;
        }
      }
    </style>
  </head>

  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>

    <!-- Loading screen -->
    <div id="loading-screen">
      <div class="loading-wordmark">
        <div class="loading-logo">XEEVIA</div>
        <div class="loading-tagline">Own Your Social</div>
      </div>
      <div class="spinner-wrap">
        <div class="spinner"></div>
      </div>
    </div>

    <!-- SW update banner (shown to Grova users and outdated Xeevia users) -->
    <div id="update-banner">
      <div class="update-content">
        <div class="update-icon">X</div>
        <div class="update-text">
          <div class="update-title">Xeevia just got better ✨</div>
          <div class="update-subtitle">
            A new version is ready — reload to get it.
          </div>
        </div>
        <div class="update-actions">
          <button id="update-reload" class="update-btn primary">Reload</button>
          <button id="update-dismiss" class="update-btn secondary">
            Later
          </button>
        </div>
      </div>
    </div>

    <!-- PWA install prompt -->
    <div id="install-prompt" class="install-prompt">
      <div class="install-content">
        <div class="install-icon">X</div>
        <div class="install-text">
          <div class="install-title">Install Xeevia</div>
          <div class="install-subtitle">Own your content. Earn engagement.</div>
        </div>
        <div class="install-actions">
          <button id="install-button" class="install-btn primary">
            Install
          </button>
          <button id="dismiss-install" class="install-btn secondary">
            Later
          </button>
        </div>
      </div>
    </div>

    <!-- Install confirmation modal -->
    <div id="install-modal" class="install-modal-overlay">
      <div class="install-modal">
        <div class="modal-header">
          <div class="modal-icon">X</div>
          <div class="modal-text">
            <div class="modal-title">Add Xeevia to Home Screen</div>
            <div class="modal-subtitle">
              Get the full app experience with instant access
            </div>
          </div>
        </div>

        <div class="modal-features">
          <div class="modal-feature">
            <div class="modal-feature-icon">✓</div>
            <div>Launch from your home screen</div>
          </div>
          <div class="modal-feature">
            <div class="modal-feature-icon">✓</div>
            <div>Work offline with cached content</div>
          </div>
          <div class="modal-feature">
            <div class="modal-feature-icon">✓</div>
            <div>Instant push notifications</div>
          </div>
          <div class="modal-feature">
            <div class="modal-feature-icon">✓</div>
            <div>Native app-like experience</div>
          </div>
        </div>

        <div class="modal-buttons">
          <button id="modal-cancel" class="modal-btn secondary">Not Now</button>
          <button id="modal-confirm" class="modal-btn primary">
            Add to Home Screen
          </button>
        </div>
      </div>
    </div>

    <div id="root"></div>

    <script>
      /* ============================================================
         SERVICE WORKER REGISTRATION + UPDATE DETECTION
         ============================================================ */
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js", { scope: "/", updateViaCache: "none" })
            .then((registration) => {
              console.log("[PWA] SW registered:", registration.scope);

              // Check for updates periodically (every 60 seconds while page open)
              setInterval(() => registration.update(), 60000);

              // New SW found (update available)
              registration.addEventListener("updatefound", () => {
                const newWorker = registration.installing;
                if (!newWorker) return;

                console.log("[PWA] New SW found — waiting for it to install");

                newWorker.addEventListener("statechange", () => {
                  // New SW installed and waiting — old SW still controlling the page
                  if (
                    newWorker.state === "installed" &&
                    navigator.serviceWorker.controller
                  ) {
                    console.log("[PWA] New SW waiting — showing update banner");
                    showUpdateBanner(newWorker);
                  }
                });
              });
            })
            .catch((err) =>
              console.error("[PWA] SW registration failed:", err),
            );

          // When a new SW takes control, reload the page automatically
          // (only after the user clicked "Reload" in the banner)
          let refreshing = false;
          navigator.serviceWorker.addEventListener("controllerchange", () => {
            if (!refreshing) {
              refreshing = true;
              console.log("[PWA] New SW is controlling — reloading page");
              window.location.reload();
            }
          });
        });

        // Listen for messages FROM the service worker
        navigator.serviceWorker.addEventListener("message", (event) => {
          const msg = event.data;
          if (!msg) return;

          switch (msg.type) {
            case "SW_UPDATED":
              // The new SW just activated (e.g. on first install or forced update)
              // The banner was likely already shown by updatefound above,
              // but if not (e.g. user was offline), show it now
              console.log("[PWA] SW_UPDATED received:", msg.version);
              break;

            case "NOTIFICATION_CLICKED":
              // SW is telling the app to navigate to a deep-link URL
              // The React app listens for this on window to handle routing
              window.dispatchEvent(
                new CustomEvent("xeevia:notification-click", { detail: msg }),
              );
              break;

            case "PUSH_RECEIVED":
              // New push while app is focused — React app handles badge refresh
              window.dispatchEvent(
                new CustomEvent("xeevia:push-received", {
                  detail: msg.payload,
                }),
              );
              break;

            default:
              break;
          }
        });
      }

      /* ============================================================
         UPDATE BANNER LOGIC
         ============================================================ */
      var _pendingNewWorker = null;

      function showUpdateBanner(newWorker) {
        _pendingNewWorker = newWorker;
        var banner = document.getElementById("update-banner");
        if (banner) banner.classList.add("show");
      }

      document
        .getElementById("update-reload")
        ?.addEventListener("click", function () {
          var banner = document.getElementById("update-banner");
          if (banner) banner.classList.remove("show");

          if (_pendingNewWorker) {
            // Tell the waiting SW to activate now
            _pendingNewWorker.postMessage({ type: "SKIP_WAITING" });
            // controllerchange listener above will reload the page
          } else {
            window.location.reload();
          }
        });

      document
        .getElementById("update-dismiss")
        ?.addEventListener("click", function () {
          var banner = document.getElementById("update-banner");
          if (banner) banner.classList.remove("show");
          // They can update next time they close and reopen the app
        });

      /* ============================================================
         PWA INSTALL PROMPT LOGIC
         ============================================================ */
      var isStandalone =
        window.matchMedia("(display-mode: standalone)").matches ||
        window.navigator.standalone === true;

      console.log("[PWA] Standalone:", isStandalone);

      var INSTALL_KEY = "xeevia_app_installed";
      var DISMISS_KEY = "xeevia_installDismissed";

      var deferredPrompt = null;

      window.addEventListener("beforeinstallprompt", function (e) {
        e.preventDefault();

        if (localStorage.getItem(INSTALL_KEY) === "true") {
          console.log("[PWA] Already installed on this device");
          return;
        }

        deferredPrompt = e;
        console.log("[PWA] Install prompt deferred");

        setTimeout(function () {
          var prompt = document.getElementById("install-prompt");
          if (prompt && !localStorage.getItem(DISMISS_KEY)) {
            prompt.classList.add("show");
          }
        }, 4000);
      });

      document
        .getElementById("install-button")
        ?.addEventListener("click", function (e) {
          e.preventDefault();
          e.stopPropagation();
          if (!deferredPrompt) return;
          document.getElementById("install-prompt").classList.remove("show");
          document.getElementById("install-modal").classList.add("show");
        });

      document
        .getElementById("modal-cancel")
        ?.addEventListener("click", function (e) {
          e.preventDefault();
          document.getElementById("install-modal").classList.remove("show");
          localStorage.setItem(DISMISS_KEY, "true");
        });

      document
        .getElementById("modal-confirm")
        ?.addEventListener("click", async function (e) {
          e.preventDefault();
          if (!deferredPrompt) return;
          document.getElementById("install-modal").classList.remove("show");
          console.log("[PWA] Showing browser install prompt...");
          await deferredPrompt.prompt();
          var result = await deferredPrompt.userChoice;
          console.log("[PWA] Install outcome:", result.outcome);
          if (result.outcome === "accepted") {
            localStorage.setItem(INSTALL_KEY, "true");
          }
          deferredPrompt = null;
        });

      document
        .getElementById("dismiss-install")
        ?.addEventListener("click", function (e) {
          e.preventDefault();
          document.getElementById("install-prompt").classList.remove("show");
          localStorage.setItem(DISMISS_KEY, "true");
        });

      window.addEventListener("appinstalled", function () {
        console.log("[PWA] Xeevia installed successfully");
        localStorage.setItem(INSTALL_KEY, "true");
        deferredPrompt = null;
      });

      if (isStandalone) {
        localStorage.setItem(INSTALL_KEY, "true");
      }

      /* ============================================================
         LOADING SCREEN DISMISS
         ============================================================ */
      window.addEventListener("load", function () {
        setTimeout(function () {
          var loading = document.getElementById("loading-screen");
          if (loading) {
            loading.style.opacity = "0";
            loading.style.transition = "opacity 0.4s ease";
            setTimeout(function () {
              loading.remove();
            }, 400);
          }
        }, 500);
      });
    </script>
  </body>
</html>
